<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Cartoon Bird - Animated Previews</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;font-family:Arial,sans-serif;}
canvas{display:block;background:#87CEEB;}
#home,#gameOver{position:absolute;top:0;left:0;width:100%;height:100%;
display:flex;flex-direction:column;justify-content:center;align-items:center;background:#87CEEB;z-index:10;}
#birdSelection img{width:60px;height:60px;margin:0 5px;cursor:pointer;border:2px solid transparent;}
#birdSelection img.selected{border-color:red;}
#drawCanvas{border:2px solid black;margin:10px;}
button{font-size:16px;margin-top:5px;padding:6px 10px;cursor:pointer;}
#ui{position:absolute;top:12px;left:12px;color:black;z-index:11;}
#customBirdsContainer{display:flex;flex-wrap:wrap;margin-top:10px;}
.customBirdThumb{position:relative;margin:5px;display:flex;justify-content:center;align-items:center;}
.deleteBtn{position:absolute;top:-5px;right:-5px;background:red;color:white;border:none;border-radius:50%;width:18px;height:18px;font-size:12px;cursor:pointer;}
</style>
</head>
<body>

<!-- Home Screen -->
<div id="home">
<h1>Flappy Cartoon Bird</h1>

<p>Draw your own bird:</p>
<canvas id="drawCanvas" width="120" height="120"></canvas>
<div>
<button id="clearBtn">Clear</button>
<button id="saveBtn">Save Bird</button>
</div>

<p>Choose from birds:</p>
<div id="birdSelection">
  <img src="https://raw.githubusercontent.com/AbelTesfaye/FlappyBirdAssets/main/bird1.png" data-index="0" class="selected">
  <img src="https://raw.githubusercontent.com/AbelTesfaye/FlappyBirdAssets/main/bird2.png" data-index="1">
  <img src="https://raw.githubusercontent.com/AbelTesfaye/FlappyBirdAssets/main/bird3.png" data-index="2">
</div>

<p>Your Custom Birds:</p>
<div id="customBirdsContainer"></div>

<button id="playBtn">Play</button>
</div>

<!-- Game Over -->
<div id="gameOver" style="display:none;">
<h1>Game Over</h1>
<p id="finalScore">Score: 0</p>
<button id="restartBtn">Restart</button>
</div>

<div id="ui" style="display:none;">
<span id="score">Score: 0</span> | Coins: <span id="coins">0</span><br>
Difficulty:
<button onclick="setDifficulty('Easy')">Easy</button>
<button onclick="setDifficulty('Classic')">Classic</button>
<button onclick="setDifficulty('Hard')">Hard</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
// --- Bird Drawing ---
const drawCanvas=document.getElementById("drawCanvas");
const dCtx=drawCanvas.getContext("2d");
let drawing=false;
function drawEvent(x,y){dCtx.fillStyle="red";dCtx.beginPath();dCtx.arc(x,y,5,0,Math.PI*2);dCtx.fill();}
drawCanvas.addEventListener("mousedown",()=>drawing=true);
drawCanvas.addEventListener("mouseup",()=>drawing=false);
drawCanvas.addEventListener("mouseleave",()=>drawing=false);
drawCanvas.addEventListener("mousemove",e=>{if(drawing){const r=drawCanvas.getBoundingClientRect();drawEvent(e.clientX-r.left,e.clientY-r.top);}});
drawCanvas.addEventListener("touchstart",()=>drawing=true);
drawCanvas.addEventListener("touchend",()=>drawing=false);
drawCanvas.addEventListener("touchmove",e=>{if(drawing){e.preventDefault();const r=drawCanvas.getBoundingClientRect();for(let t of e.touches){drawEvent(t.clientX-r.left,t.clientY-r.top);}}},{passive:false});
document.getElementById("clearBtn").onclick=()=>{dCtx.clearRect(0,0,drawCanvas.width,drawCanvas.height);};

// --- Bird Management ---
let customBirds=[]; // Image objects
let allBirds=[]; // all birds (pre-made + custom)
let selectedBirdIndex=0;

// Pre-made birds
const preBirds=[
"https://raw.githubusercontent.com/AbelTesfaye/FlappyBirdAssets/main/bird1.png",
"https://raw.githubusercontent.com/AbelTesfaye/FlappyBirdAssets/main/bird2.png",
"https://raw.githubusercontent.com/AbelTesfaye/FlappyBirdAssets/main/bird3.png"
];
preBirds.forEach(src=>{const i=new Image();i.src=src;allBirds.push(i);});

// Save custom bird
document.getElementById("saveBtn").onclick=()=>{
  const img=new Image(); img.src=drawCanvas.toDataURL();
  customBirds.push(img); allBirds.push(img); selectedBirdIndex=allBirds.length-1;
  updateCustomBirdsUI();
  alert("Bird saved! Click it to select, or press delete to remove.");
};

// Update custom bird thumbnails
function updateCustomBirdsUI(){
  const container=document.getElementById("customBirdsContainer");
  container.innerHTML="";
  customBirds.forEach((b,i)=>{
    const div=document.createElement("div"); div.className="customBirdThumb";
    const imgEl=document.createElement("canvas"); imgEl.width=60; imgEl.height=60;
    const ctxImg=imgEl.getContext("2d");
    div.appendChild(imgEl);
    const delBtn=document.createElement("button"); delBtn.className="deleteBtn"; delBtn.innerText="Ã—"; delBtn.onclick=()=>{deleteCustomBird(i);};
    div.appendChild(delBtn);
    container.appendChild(div);
  });
}

// Delete custom bird
function deleteCustomBird(i){
  if(confirm("Delete this custom bird?")){
    allBirds.splice(preBirds.length+i,1);
    customBirds.splice(i,1);
    if(selectedBirdIndex>=allBirds.length) selectedBirdIndex=allBirds.length-1;
    updateCustomBirdsUI();
  }
}

// Pre-made bird selection
document.querySelectorAll("#birdSelection img").forEach(img=>{
  img.addEventListener("click",()=>{
    document.querySelectorAll("#birdSelection img").forEach(i=>i.classList.remove("selected"));
    img.classList.add("selected");
    selectedBirdIndex=parseInt(img.dataset.index);
  });
});
function updateSelection(){
  document.querySelectorAll("#birdSelection img").forEach(i=>i.classList.remove("selected"));
  if(selectedBirdIndex<preBirds.length){
    const img=document.querySelector(`#birdSelection img[data-index='${selectedBirdIndex}']`);
    if(img) img.classList.add("selected");
  }
}

// --- Bird Preview Animation ---
let previewFrame=0;
function animatePreviews(){
  previewFrame+=0.05;
  const container=document.getElementById("customBirdsContainer");
  container.querySelectorAll(".customBirdThumb canvas").forEach((c,i)=>{
    const ctxC=c.getContext("2d");
    ctxC.clearRect(0,0,c.width,c.height);
    const yOffset=Math.sin(previewFrame+i)*5+c.height/2;
    ctxC.drawImage(customBirds[i],c.width/2-30,yOffset-30,60,60);
  });
  requestAnimationFrame(animatePreviews);
}
animatePreviews();

// --- Game Canvas ---
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");
const bgImg=new Image(); bgImg.src="https://raw.githubusercontent.com/AbelTesfaye/FlappyBirdAssets/main/sky.png";
const cloudImg=new Image(); cloudImg.src="https://raw.githubusercontent.com/AbelTesfaye/FlappyBirdAssets/main/clouds.png";
const groundImg=new Image(); groundImg.src="https://raw.githubusercontent.com/AbelTesfaye/FlappyBirdAssets/main/ground.png";
const coinImg=new Image(); coinImg.src="https://raw.githubusercontent.com/AbelTesfaye/FlappyBirdAssets/main/coin.png";
const pipeImg=new Image(); pipeImg.src="https://raw.githubusercontent.com/AbelTesfaye/FlappyBirdAssets/main/pipe.png";

let bird={x:0,y:0,width:0,height:0,vel:0};
let pipes=[],coins=[],score=0,coinCount=0;
let gravity=0.5,flap=-10,frameCount=0;
let pipeGap,pipeSpeed,spawnTime,lastPipeTime=0;
let gameStarted=false;
let cloudOffset=0;
const difficulties={Easy:{pipeSpeed:3,pipeGap:0.4,spawnTime:2000},Classic:{pipeSpeed:5,pipeGap:0.3,spawnTime:1500},Hard:{pipeSpeed:7,pipeGap:0.25,spawnTime:1200}};
let currentDifficulty="Classic";

// --- UI ---
document.getElementById("playBtn").addEventListener("click",()=>{
  document.getElementById("home").style.display="none"; document.getElementById("ui").style.display="block";
  initCanvas(); gameStarted=true;
});
document.getElementById("restartBtn").addEventListener("click",()=>{
  document.getElementById("gameOver").style.display="none"; document.getElementById("ui").style.display="block";
  initCanvas(); gameStarted=true;
});
function setDifficulty(level){currentDifficulty=level; initCanvas();}

// --- Canvas Setup ---
function initCanvas(){
  canvas.width=window.innerWidth; canvas.height=window.innerHeight;
  bird.x=canvas.width*0.25; bird.y=canvas.height/2;
  bird.width=canvas.width*0.07; bird.height=bird.width; bird.vel=0;
  pipes=[]; coins=[]; score=0; coinCount=0; frameCount=0;
  pipeGap=canvas.height*difficulties[currentDifficulty].pipeGap;
  pipeSpeed=difficulties[currentDifficulty].pipeSpeed;
  spawnTime=difficulties[currentDifficulty].spawnTime;
}
window.addEventListener("resize",initCanvas);

// --- Input ---
canvas.addEventListener("mousedown",()=>{if(gameStarted)bird.vel=flap;});
canvas.addEventListener("touchstart",()=>{if(gameStarted)bird.vel=flap;});

// --- Pipes & Coins ---
function createPipe(){
  const top=Math.random()*(canvas.height-pipeGap-80)+40;
  pipes.push({x:canvas.width,top,width:canvas.width*0.12,passed:false});
  coins.push({x:canvas.width+canvas.width*0.06,y:top+pipeGap/2,width:30,height:30,collected:false});
}

// --- Update ---
function update(){
  frameCount++; cloudOffset+=0.3;
  bird.vel+=gravity; bird.y+=bird.vel;
  if(bird.y+bird.height/2>canvas.height) bird.y=canvas.height-bird.height/2,bird.vel=0;
  if(bird.y-bird.height/2<0) bird.y=bird.height/2,bird.vel=0;
  const now=Date.now();
  if(now-lastPipeTime>spawnTime){ createPipe(); lastPipeTime=now; }

  pipes.forEach(pipe=>{
    pipe.x-=pipeSpeed;
    if(bird.x+bird.width/2>pipe.x && bird.x-bird.width/2<pipe.x+pipe.width &&
      (bird.y-bird.height/2<pipe.top || bird.y+bird.height/2>pipe.top+pipeGap)){ endGame(); }
    if(!pipe.passed && pipe.x+pipe.width<bird.x){ pipe.passed=true; score++; document.getElementById("score").innerText="Score: "+score; }
  });
  pipes=pipes.filter(p=>p.x+p.width>0);

  coins.forEach(c=>{
    c.x-=pipeSpeed;
    if(!c.collected && bird.x+bird.width/2>c.x && bird.x-bird.width/2<c.x+c.width &&
      bird.y+bird.height/2>c.y && bird.y-bird.height/2<c.y+c.height){ c.collected=true; coinCount++; document.getElementById("coins").innerText=coinCount; }
  });
  coins=coins.filter(c=>c.x+c.width>0);
}

// --- Draw ---
function draw(){
  if(bgImg.complete) ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);
  if(cloudImg.complete){
    ctx.drawImage(cloudImg,-cloudOffset%canvas.width,50,canvas.width,120);
    ctx.drawImage(cloudImg,canvas.width-cloudOffset%canvas.width,50,canvas.width,120);
  }
  pipes.forEach(pipe=>{
    if(pipeImg.complete) ctx.drawImage(pipeImg,pipe.x,0,pipe.width,pipe.top);
    if(pipeImg.complete) ctx.drawImage(pipeImg,pipe.x,pipe.top+pipeGap,pipe.width,canvas.height-pipe.top-pipeGap);
  });
  coins.forEach(c=>{ if(!c.collected && coinImg.complete) ctx.drawImage(coinImg,c.x,c.y,c.width,c.height); });
  if(groundImg.complete) ctx.drawImage(groundImg,0,canvas.height-50,canvas.width,50);

  const bImg=allBirds[selectedBirdIndex];
  if(bImg.complete){
    const yOffset=Math.sin(frameCount*0.1)*5;
    ctx.drawImage(bImg,bird.x-bird.width/2,bird.y-bird.height/2+yOffset,bird.width,bird.height);
  }
}

// --- End Game ---
function endGame(){ gameStarted=false; document.getElementById("gameOver").style.display="flex";
document.getElementById("finalScore").innerText="Score: "+score+" | Coins: "+coinCount; document.getElementById("ui").style.display="none";}

// --- Game Loop ---
function loop(){if(gameStarted){update();draw();} requestAnimationFrame(loop);}
loop();
</script>

</body></html>
