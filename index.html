import pygame
import random
import sys
import time

# ======================
# Initialization
# ======================
pygame.init()

# Screen
WIDTH, HEIGHT = 600, 400
win = pygame.display.set_mode((WIDTH, HEIGHT))
pygame.display.set_caption("Minion Mayhem Ultimate ðŸŒðŸµ")

# Colors
WHITE = (255, 255, 255)
BLACK = (0,0,0)
YELLOW = (255,255,0)
BLUE = (0,0,255)

# Clock
clock = pygame.time.Clock()

# ======================
# Assets (replace with your images if available)
# ======================
try:
    minion_img = pygame.image.load("assets/minion.png")
    banana_img = pygame.image.load("assets/banana.png")
    obstacle_img = pygame.image.load("assets/obstacle.png")
    bg_img = pygame.image.load("assets/bg.png")
except:
    # Placeholder shapes if no images
    minion_img = pygame.Surface((50,60))
    minion_img.fill(BLUE)
    banana_img = pygame.Surface((30,40))
    banana_img.fill(YELLOW)
    obstacle_img = pygame.Surface((50,50))
    obstacle_img.fill(BLACK)
    bg_img = pygame.Surface((WIDTH,HEIGHT))
    bg_img.fill(WHITE)

# ======================
# Game Variables
# ======================
score = 0
energy = 5

# Minion Endless Runner
minion_x = WIDTH//2 - 25
minion_y = HEIGHT - 70
minion_speed = 7

obstacles = []
bananas = []
OBSTACLE_WIDTH, OBSTACLE_HEIGHT = 50,50
BANANA_WIDTH, BANANA_HEIGHT = 30,40
obstacle_speed = 5
spawn_timer = 0

# Rooms for adventure
rooms = {
    "Lab": ["Kitchen", "Vault"],
    "Kitchen": ["Lab", "Garden"],
    "Garden": ["Kitchen", "Secret Lair"],
    "Vault": ["Lab"],
    "Secret Lair": ["Garden"]
}
room_descriptions = {
    "Lab":"Gru's Lab. Gadgets are buzzing!",
    "Kitchen":"The kitchen smells sweet! ðŸŒ",
    "Garden":"Sunny garden. Bees flying!",
    "Vault":"Vault full of treasures!",
    "Secret Lair":"Villain spotted! Watch out!"
}
current_room = "Lab"

font = pygame.font.SysFont(None,30)

# ======================
# Functions
# ======================
def minion_ascii():
    print(r"""
     â €â €â €â €â €â¢€â£ â£¤â£¤â£¤â£€â €â €â €â €
     â €â €â €â €â£´â£¿â¡¿â ¿â ¿â¢¿â£¿â£¦â €â €
     â €â €â €â¢¸â£¿â¡‡â €â €â €â €â¢¸â£¿â¡‡â €
     â €â €â €â¢¸â£¿â¡‡ â € â €â €â €â¢¸â£¿â¡‡â €
     â €â €â €â¢¸â£¿â¡‡â €â €â €â €â¢¸â£¿â¡‡â €
     â €â €â €â ¸â£¿â£§â£€â£€â£€â£´â£¿â¡‡â €â €
     â €â €â €â €â ˆâ »â£¿â£¿â£¿â£¿â Ÿâ â €â €
    """)

def random_event():
    global energy, score
    event = random.choice(["slip","prank","banana_bonus","nothing","boss"])
    if event=="slip":
        energy-=1
        print("Oops! Slipped on a banana peel! Energy -1")
    elif event=="prank":
        energy-=1
        print("Minion prank! Energy -1")
    elif event=="banana_bonus":
        bonus=random.randint(1,3)
        score+=bonus
        print(f"Lucky! +{bonus} bananas!")
    elif event=="boss":
        boss_fight()
    else:
        print("Nothing exciting happens.")

def banana_mini_game():
    global score
    print("\nMini-Game: Guess the Banana Number 1-5")
    number=random.randint(1,5)
    guess=input("Your guess: ")
    if guess.isdigit() and int(guess)==number:
        print("Correct! +3 bananas")
        score+=3
    else:
        print(f"Wrong! Number was {number}")

def boss_fight():
    global score, energy
    print("\nBoss Alert! Vector appears!")
    minion_ascii()
    success=random.choice([True,False])
    if success:
        print("Hit Vector! +5 bananas")
        score+=5
    else:
        print("Vector zapped you! Energy -2")
        energy-=2

# ======================
# Main Game Loop
# ======================
running=True
mode="menu"

while running:
    if mode=="menu":
        win.fill(WHITE)
        title=font.render("Minion Mayhem Ultimate",True,BLACK)
        run_mode=font.render("Press R for Runner, A for Adventure Mode",True,BLACK)
        win.blit(title,(100,100))
        win.blit(run_mode,(50,200))
        pygame.display.update()
        for event in pygame.event.get():
            if event.type==pygame.QUIT: running=False
            if event.type==pygame.KEYDOWN:
                if event.key==pygame.K_r: mode="runner"
                if event.key==pygame.K_a: mode="adventure"
        continue

    # ======================
    # Adventure Mode
    # ======================
    if mode=="adventure":
        print(f"\nYou are in {current_room}. {room_descriptions[current_room]}")
        print(f"Bananas: {score}, Energy: {energy}")
        print("1.Move 2.Search 3.Mini-Game 4.Rest")
        choice=input("> ")
        if choice=="1":
            print("Where to?")
            for i, r in enumerate(rooms[current_room]):
                print(f"{i+1}.{r}")
            c=input("> ")
            if c.isdigit() and 1<=int(c)<=len(rooms[current_room]):
                current_room=rooms[current_room][int(c)-1]
                random_event()
            else:
                print("Invalid room.")
        elif choice=="2":
            found=random.randint(1,3)
            score+=found
            print(f"Found {found} bananas!")
            random_event()
        elif choice=="3":
            banana_mini_game()
        elif choice=="4":
            energy+=1
            print("Rested +1 energy")
        else:
            print("Pick 1-4.")
        if energy<=0:
            print(f"Game Over! Bananas collected: {score}")
            running=False

    # ======================
    # Runner Mode
    # ======================
    if mode=="runner":
        win.blit(bg_img,(0,0))
        spawn_timer+=1
        if spawn_timer>30:
            spawn_timer=0
            if random.random()<0.6:
                obstacles.append(pygame.Rect(random.randint(0,WIDTH-OBSTACLE_WIDTH),-OBSTACLE_HEIGHT,OBSTACLE_WIDTH,OBSTACLE_HEIGHT))
            else:
                bananas.append(pygame.Rect(random.randint(0,WIDTH-BANANA_WIDTH),-BANANA_HEIGHT,BANANA_WIDTH,BANANA_HEIGHT))

        for event in pygame.event.get():
            if event.type==pygame.QUIT:
                running=False

        keys=pygame.key.get_pressed()
        if keys[pygame.K_LEFT] and minion_x>0: minion_x-=minion_speed
        if keys[pygame.K_RIGHT] and minion_x<WIDTH-50: minion_x+=minion_speed

        # Move obstacles and bananas
        for obs in obstacles:
            obs.y+=obstacle_speed
            win.blit(obstacle_img,(obs.x,obs.y))
        for b in bananas:
            b.y+=obstacle_speed
            win.blit(banana_img,(b.x,b.y))

        # Collision
        minion_rect=pygame.Rect(minion_x,minion_y,50,60)
        for obs in obstacles:
            if minion_rect.colliderect(obs):
                print(f"Game Over! Score: {score}")
                pygame.quit()
                sys.exit()
        for b in bananas[:]:
            if minion_rect.colliderect(b):
                score+=1
                bananas.remove(b)

        win.blit(minion_img,(minion_x,minion_y))
        score_text=font.render(f"Bananas: {score}",True,BLACK)
        win.blit(score_text,(10,10))

        pygame.display.update()
        clock.tick(30)
